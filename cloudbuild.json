{
  "steps": [
    {
      "name": "gcr.io/google.com/cloudsdktool/cloud-sdk",
      "entrypoint": "bash",
      "env": [ 'GIT_DISCOVERY_ACROSS_FILESYSTEM=1' ],
      "args": [
          "git",
          "submodule",
          "update",
          "--init",
          "--recursive"
        ]
    },
    {
      "name": "docker:stable",
      "args": [
          "build",
          "-t",
          "gcr.io/$PROJECT_ID/api:$COMMIT_SHA",
          "."
        ]
    },
    {
      "name": "docker:stable",
      "args": [
          "push",
          "gcr.io/$PROJECT_ID/api:$COMMIT_SHA"
        ]
    },
    {
        "name": "gcr.io/google.com/cloudsdktool/cloud-sdk",
        "entrypoint": "gcloud",
        "args": [
          "run",
          "deploy",
          "api",
          "--image",
          "gcr.io/$PROJECT_ID/api:$COMMIT_SHA",
          "--region",
          "us-central1",
          "--platform",
          "managed"
        ]
    }
  ],
  "images": [
     "gcr.io/$PROJECT_ID/api:$COMMIT_SHA"
   ]
}
